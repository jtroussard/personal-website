steps:
  - name: gcr.io/cloud-builders/git
    args: ['clone', '--single-branch', '--depth', '1', 'https://github.com/jtroussard/personal-website', '.']
  - name: gcr.io/cloud-builders/npm
    args: ['install']
  - name: gcr.io/cloud-builders/npm
    args: ['run', 'build']
  - name: gcr.io/cloud-builders/gcloud
    args: ['compute', 'scp', '--recurse', '.', 'instance-1:/home/jacques_troussard']
  - name: gcr.io/cloud-builders/ssh
    args: ['-i', '/home/jacques_troussard/.ssh/id_rsa', 'jacques_troussard@instance-1', 'supervisorctl', 'reload']


steps:
  - name: gcr.io/cloud-builders/git
    args: ['clone', '--single-branch', '--depth', '1', 'https://github.com/jtroussard/personal-website', '.']
  - name: gcr.io/cloud-builders/python
    entrypoint: python3
    args: ['-m', 'venv', 'venv']
  - name: gcr.io/cloud-builders/python
    entrypoint: /bin/bash
    args: ['-c', 'source env/bin/activate && pip install -r requirements.txt']
  - name: gcr.io/cloud-builders/python
    entrypoint: /bin/bash
    args: ['-c', 'source env/bin/activate']
  - name: gcr.io/cloud-builders/gcloud
    args: ['compute', 'scp', '--recurse', '.', 'instance-1:/home/user']
  - name: gcr.io/cloud-builders/ssh
    args: ['-i', '/home/jacques_troussard/.ssh/id_rsa', 'jacques_troussard@instance-1', 'sudo', 'supervisorctl', 'restart', 'flaskapp']
